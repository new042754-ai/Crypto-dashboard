<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JK ALGO â€” Market (Live + Mini Charts)</title>
  <style>
    :root { --green:#22c55e; --red:#ef4444; --muted:#666; --ink:#111; --line:#eaeaea; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#fff;color:var(--ink);padding-bottom:84px}
    .header{padding:16px 16px 8px;font-size:24px;font-weight:800}
    .tabs{display:flex;gap:18px;overflow-x:auto;padding:8px 16px;border-bottom:1px solid var(--line)}
    .tab{white-space:nowrap;font-size:14px;color:var(--muted);padding:6px 0}
    .tab.active{color:#f59e0b;border-bottom:2px solid #f59e0b;font-weight:700}

    .list{padding:6px 10px}
    .row{display:flex;align-items:center;justify-content:space-between;padding:12px 6px;border-bottom:1px solid var(--line);gap:10px}
    .left{display:flex;align-items:center;gap:10px;min-width:160px}
    .logo{width:32px;height:32px;border-radius:16px;background:#f3f4f6;object-fit:contain}
    .names{line-height:1.1}
    .pair{font-weight:700}
    .pct{font-size:12px}
    .pct.up{color:var(--green)} .pct.down{color:var(--red)} .pct.na{color:var(--muted)}
    .spark{flex:1;min-width:120px;height:40px}
    .right{display:flex;gap:8px;align-items:center}
    .pill{min-width:110px;text-align:center;padding:8px 12px;border-radius:10px;color:#fff;font-weight:800}
    .sell{background:var(--red)} .buy{background:var(--green)}

    /* Bottom nav */
    .nav{position:fixed;left:0;right:0;bottom:0;height:72px;background:#fff;border-top:1px solid var(--line);display:flex;justify-content:space-around;align-items:center}
    .nav a{display:flex;flex-direction:column;align-items:center;gap:2px;text-decoration:none;color:#555;font-size:13px}
    .nav a.active{color:#000;font-weight:700}
    .mi{font-family:'Material Icons';font-weight:normal;font-style:normal;font-size:26px;line-height:1;display:inline-block}
  </style>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Lightweight Charts for sparklines -->
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body>
  <div class="header">Market</div>
  <div class="tabs">
    <div class="tab active">Hot</div>
    <div class="tab">Favourite</div>
    <div class="tab">Forex</div>
    <div class="tab">Crypto</div>
    <div class="tab">Metals</div>
    <div class="tab">Indices</div>
  </div>

  <div id="list" class="list"></div>

  <!-- Bottom Navigation -->
  <nav class="nav">
    <a href="#"><span class="mi">home</span><span>Home</span></a>
    <a href="#" class="active"><span class="mi">candlestick_chart</span><span>Market</span></a>
    <a href="#"><span class="mi">description</span><span>Trade</span></a>
    <a href="#"><span class="mi">explore</span><span>Discover</span></a>
    <a href="#"><span class="mi">person</span><span>My Account</span></a>
  </nav>

  <script>
    // ---------- Coins to show (logo via cryptoicons.org) ----------
    const COINS = [
      {sym:'BTCUSDT', name:'BTC/USDT', icon:'btc'},
      {sym:'ETHUSDT', name:'ETH/USDT', icon:'eth'},
      {sym:'SOLUSDT', name:'SOL/USDT', icon:'sol'},
      {sym:'XRPUSDT', name:'XRP/USDT', icon:'xrp'},
      {sym:'DOGEUSDT', name:'DOGE/USDT', icon:'doge'},
      {sym:'TRXUSDT', name:'TRX/USDT', icon:'trx'},
      {sym:'ADAUSDT', name:'ADA/USDT', icon:'ada'},
      {sym:'ETCUSDT', name:'ETC/USDT', icon:'etc'}
    ];
    const iconUrl = (code, size=64) => `https://cryptoicons.org/api/icon/${code}/${size}`;

    // ---------- CORS-safe fetch ----------
    async function fetchJson(urls){
      for (const u of urls) {
        try { const r = await fetch(u, {cache:'no-store'}); if (r.ok) return await r.json(); } catch(e){}
      }
      return null;
    }
    const bookUrl = s => [
      `https://data.binance.com/api/v3/ticker/bookTicker?symbol=${s}`,
      `https://api.binance.com/api/v3/ticker/bookTicker?symbol=${s}`
    ];
    const dayUrl = s => [
      `https://data.binance.com/api/v3/ticker/24hr?symbol=${s}`,
      `https://api.binance.com/api/v3/ticker/24hr?symbol=${s}`
    ];
    const klineUrl = (s, i, n=120) => [
      `https://data.binance.com/api/v3/klines?symbol=${s}&interval=${i}&limit=${n}`,
      `https://api.binance.com/api/v3/klines?symbol=${s}&interval=${i}&limit=${n}`
    ];

    // ---------- Render skeleton rows ----------
    const list = document.getElementById('list');
    list.innerHTML = COINS.map((c, i) => `
      <div class="row" id="row-${i}">
        <div class="left">
          <img class="logo" src="${iconUrl(c.icon,64)}" onerror="this.style.display='none'">
          <div class="names">
            <div class="pair">${c.name}</div>
            <div class="pct na" id="pct-${i}">--</div>
          </div>
        </div>
        <div class="spark" id="spark-${i}"></div>
        <div class="right">
          <div class="pill sell" id="sell-${i}">--</div>
          <div class="pill buy" id="buy-${i}">--</div>
        </div>
      </div>
    `).join('');

    // ---------- Draw a tiny sparkline chart ----------
    function drawSpark(container, closes) {
      container.innerHTML = '';
      const chart = LightweightCharts.createChart(container, {
        layout:{background:{type:'Solid',color:'#fff'}, textColor:'#555'},
        grid:{vertLines:{color:'#ffffff'}, horzLines:{color:'#ffffff'}},
        rightPriceScale:{visible:false}, timeScale:{visible:false},
        width: container.clientWidth, height: container.clientHeight
      });
      const s = chart.addLineSeries({lineWidth:2});
      const baseTime = Math.floor(Date.now()/1000) - (closes.length*60);
      s.setData(closes.map((v, idx)=>({ time: baseTime + idx*60, value: v })));
    }

    // ---------- Update one coin row ----------
    async function updateCoin(c, i){
      const [book, d24, kl] = await Promise.all([
        fetchJson(bookUrl(c.sym)),
        fetchJson(dayUrl(c.sym)),
        fetchJson(klineUrl(c.sym,'1m',120))
      ]);

      // prices
      const bid = book?.bidPrice ? +book.bidPrice : null;
      const ask = book?.askPrice ? +book.askPrice : null;
      document.getElementById(`sell-${i}`).textContent = bid ? bid.toLocaleString() : '--';
      document.getElementById(`buy-${i}`).textContent  = ask ? ask.toLocaleString() : '--';

      // 24h %
      const pctEl = document.getElementById(`pct-${i}`);
      if (d24?.priceChangePercent != null) {
        const pct = +d24.priceChangePercent;
        pctEl.textContent = (pct>=0?'+':'') + pct.toFixed(2) + '%';
        pctEl.className = 'pct ' + (pct>0?'up': pct<0?'down':'na');
      } else {
        pctEl.textContent = '--'; pctEl.className = 'pct na';
      }

      // sparkline
      if (Array.isArray(kl) && kl.length) {
        const closes = kl.map(k => +k[4]);
        const cont = document.getElementById(`spark-${i}`);
        drawSpark(cont, closes);
      }
    }

    async function updateAll(){
      await Promise.all(COINS.map(updateCoin));
    }
    updateAll();
    setInterval(updateAll, 5000);

    // resize sparklines on orientation/resize
    window.addEventListener('resize', ()=> {
      COINS.forEach((_,i) => {
        const cont = document.getElementById(`spark-${i}`);
        if (cont && cont.firstChild) { // redraw using last known width not stored; quick re-fetch:
          // lightweight: simply trigger a full refresh next tick
          setTimeout(updateAll, 50);
        }
      });
    });
  </script>
</body>
</html>

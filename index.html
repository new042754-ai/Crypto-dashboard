<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crypto Algo Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: white;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    header {
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 10px;
      background-color: #222;
    }
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    .btn-btc, .btn-eth { background-color: #333; color: white; }
    .btn-start { background-color: green; color: white; }
    .btn-stop { background-color: brown; color: white; }
    .status { margin: 10px 0; font-weight: bold; }
    .status.stopped { color: red; }
    .status.running { color: green; }
    .price-card {
      background: #222;
      padding: 15px;
      border-radius: 8px;
      margin: 10px auto;
      width: 250px;
    }
    .price { font-size: 1.5em; margin-top: 5px; }
    .strategy-card {
      background: #222;
      padding: 15px;
      border-radius: 8px;
      margin: 10px auto;
      width: 300px;
    }
    .strategy-card h3 { margin: 0 0 10px; color: red; }
    .add-btn {
      background: #111;
      border: 1px solid red;
      border-radius: 8px;
      padding: 20px;
      cursor: pointer;
      font-size: 20px;
    }
    /* Overlay */
    .overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.95);
      z-index: 9999;
      flex-direction: column;
    }
    .overlay.show { display: flex; }
    .overlay-header {
      display: flex; justify-content: space-between;
      align-items: center; background: #000;
      padding: 10px; color: white;
    }
    #tv-container { flex: 1; }
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 10000;
      justify-content: center; align-items: center;
    }
    .modal-content {
      background: #222; padding: 20px;
      border-radius: 8px; width: 300px;
      text-align: left;
    }
    .modal-content h2 { margin-top: 0; }
    .modal-content label { display: block; margin: 10px 0 5px; }
    .modal-content input, .modal-content select {
      width: 100%; padding: 8px; margin-bottom: 10px;
    }
    .modal-content button { margin-top: 10px; }
  </style>
</head>
<body>

<header>
  <button class="btn-btc" id="btn-btc">BTC</button>
  <button class="btn-eth" id="btn-eth">ETH</button>
  <button class="btn-start" id="start">Start</button>
  <button class="btn-stop" id="stop">Stop</button>
</header>

<div id="algo-status" class="status stopped">Algo Stopped</div>

<div class="price-card">
  <div>BTC</div>
  <div class="price" id="price-btc">--</div>
</div>

<div class="price-card">
  <div>ETH</div>
  <div class="price" id="price-eth">--</div>
</div>

<!-- Strategy Boxes -->
<div class="strategy-card">
  <h3>Strategy (BTC)</h3>
  <div class="add-btn" onclick="openStrategyModal('BTC')">+</div>
  <div id="strategy-btc">None selected</div>
</div>

<div class="strategy-card">
  <h3>Strategy (ETH)</h3>
  <div class="add-btn" onclick="openStrategyModal('ETH')">+</div>
  <div id="strategy-eth">None selected</div>
</div>

<!-- Chart overlay -->
<div class="overlay" id="overlay">
  <div class="overlay-header">
    <span id="overlay-title"></span>
    <button id="ov-close">Close</button>
  </div>
  <div id="tv-container"></div>
</div>

<!-- Strategy Modal -->
<div class="modal" id="strategy-modal">
  <div class="modal-content">
    <h2 id="modal-title">Choose Strategy</h2>
    <label>Type</label>
    <select id="str-type">
      <option value="sma">SMA Crossover</option>
      <option value="ema">EMA Crossover</option>
      <option value="rsi">RSI</option>
    </select>
    <label>Fast</label>
    <input type="number" id="str-fast" value="9">
    <label>Slow</label>
    <input type="number" id="str-slow" value="21">
    <label>Timeframe</label>
    <select id="str-timeframe">
      <option value="1m">1m</option>
      <option value="5m">5m</option>
      <option value="15m">15m</option>
      <option value="1h">1h</option>
    </select>
    <button onclick="saveStrategy()">Save</button>
    <button onclick="closeStrategyModal()">Cancel</button>
  </div>
</div>

<script src="https://s3.tradingview.com/tv.js"></script>
<script>
  const statusEl = document.getElementById('algo-status');
  let currentSymbol = "BTCUSDT";
  let currentCoin = "BTC";
  let activeChart = null;

  document.getElementById('start').onclick = () => {
    statusEl.textContent = 'Algo Running';
    statusEl.className = 'status running';
  };
  document.getElementById('stop').onclick = () => {
    statusEl.textContent = 'Algo Stopped';
    statusEl.className = 'status stopped';
  };

  // Price updates
  async function fetchPrice(symbol, el) {
    try {
      const res = await fetch(`https://data.binance.com/api/v3/ticker/price?symbol=${symbol}`);
      const data = await res.json();
      el.textContent = `$${parseFloat(data.price).toLocaleString()}`;
    } catch (e) { el.textContent = '--'; }
  }
  function updatePrices() {
    fetchPrice('BTCUSDT', document.getElementById('price-btc'));
    fetchPrice('ETHUSDT', document.getElementById('price-eth'));
  }
  updatePrices();
  setInterval(updatePrices, 5000);

  // Chart Overlay
  const overlay = document.getElementById('overlay');
  const overlayTitle = document.getElementById('overlay-title');
  const tvContainer = document.getElementById('tv-container');

  function openChart(label, symbol) {
    overlay.classList.add('show');
    overlayTitle.textContent = label + ' — Custom Chart';
    tvContainer.innerHTML = '';
    new TradingView.widget({
      autosize: true,
      symbol: symbol,
      interval: "15",
      timezone: "Etc/UTC",
      theme: "dark",
      style: "1",
      container_id: "tv-container",
      locale: "en",
      withdateranges: true,
      allow_symbol_change: false,
      studies: ["MASimple@tv-basicstudies"] // basic indicator
    });
  }
  document.getElementById('btn-btc').onclick = () => { currentCoin="BTC"; openChart("BTC/USDT","BINANCE:BTCUSDT"); };
  document.getElementById('btn-eth').onclick = () => { currentCoin="ETH"; openChart("ETH/USDT","BINANCE:ETHUSDT"); };
  document.getElementById('ov-close').onclick = () => overlay.classList.remove('show');

  // Strategy Modal
  let selectedCoin = null;
  function openStrategyModal(coin) {
    selectedCoin = coin;
    document.getElementById('modal-title').textContent = "Choose Strategy — " + coin;
    document.getElementById('strategy-modal').style.display = "flex";
  }
  function closeStrategyModal() {
    document.getElementById('strategy-modal').style.display = "none";
  }
  function saveStrategy() {
    const type = document.getElementById('str-type').value;
    const fast = document.getElementById('str-fast').value;
    const slow = document.getElementById('str-slow').value;
    const tf = document.getElementById('str-timeframe').value;
    const text = `${type.toUpperCase()} — fast:${fast} | slow:${slow} | tf:${tf}`;
    document.getElementById('strategy-'+selectedCoin.toLowerCase()).textContent = text;
    closeStrategyModal();
  }
</script>

</body>
  </html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>JK ALGO — Market + Account</title>

<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
<script src="https://s3.tradingview.com/tv.js"></script>
<style>
:root{--green:#22c55e;--red:#ef4444;--ink:#111827;--muted:#667085;--line:#e5e7eb;--brand:#0ea5e9;--soft:#f8fafc}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#fff;color:var(--ink);padding-bottom:84px}
.page{display:none;min-height:calc(100dvh - 84px)} .page.show{display:block}
.header{padding:16px 16px 8px;font-size:24px;font-weight:800;border-bottom:1px solid var(--line)}

/* MARKET LIST */
.tabs{display:flex;gap:18px;overflow-x:auto;padding:8px 16px;border-bottom:1px solid var(--line)}
.tab{white-space:nowrap;font-size:14px;color:var(--muted);padding:6px 0}
.tab.active{color:#f59e0b;border-bottom:2px solid #f59e0b;font-weight:700}
.list{padding:6px 10px}
.row{display:flex;align-items:center;justify-content:space-between;padding:12px 6px;border-bottom:1px solid var(--line);gap:10px;cursor:pointer}
.left{display:flex;align-items:center;gap:10px;min-width:160px}
.logo{width:32px;height:32px;border-radius:16px;background:#f3f4f6;object-fit:contain}
.names{line-height:1.1}.pair{font-weight:700}.pct{font-size:12px}
.pct.up{color:var(--green)} .pct.down{color:var(--red)} .pct.na{color:#98a2b3}
.spark{flex:1;min-width:120px;height:40px}
.right{display:flex;gap:8px;align-items:center}
.pill{width:128px;text-align:right;padding:8px 12px;border-radius:10px;color:#fff;font-weight:800;font-variant-numeric:tabular-nums}
.sell{background:var(--red)} .buy{background:var(--green)}

/* BOTTOM NAV */
.nav{position:fixed;left:0;right:0;bottom:0;height:72px;background:#fff;border-top:1px solid var(--line);display:flex;justify-content:space-around;align-items:center;z-index:20}
.nav a{display:flex;flex-direction:column;align-items:center;gap:2px;text-decoration:none;color:#555;font-size:13px}
.nav a.active{color:#000;font-weight:700}
.mi{font-family:'Material Icons';font-size:26px}

/* CHART OVERLAY */
#chartView{position:fixed;inset:0;background:#fff;display:none;flex-direction:column;z-index:9999}
.topbar{display:flex;align-items:center;gap:10px;padding:10px 12px;border-bottom:1px solid var(--line)}
.pTitle{font-weight:800;font-size:20px}
.pStats{margin-left:auto;text-align:right;font-size:12px;color:#475467}
.priceLine{display:flex;align-items:center;gap:10px;padding:10px 12px}
.livePrice{font-size:22px;font-weight:800}
.livePct{font-size:13px;padding:3px 8px;border-radius:8px;background:#f1f5f9}
.livePct.up{color:var(--green)} .livePct.down{color:var(--red)}
.tfTabs{display:flex;gap:12px;overflow-x:auto;padding:6px 12px;border-bottom:1px solid var(--line)}
.tf{padding:6px 10px;border-radius:8px;background:#f8fafc;color:#111;cursor:pointer}
.tf.active{background:#fde68a}
.tvToolbar{display:flex;align-items:center;gap:8px;margin:8px 12px 0;margin-left:auto;border:1px solid var(--line);border-radius:12px;padding:6px 8px;width:max-content}
.tbtn{display:flex;align-items:center;gap:6px;padding:6px 10px;border-radius:8px;border:1px solid #eef2f7;background:#fff;cursor:pointer;font-size:13px;color:#111}
.tbtn .mi{font-size:18px}
.chartWrap{height:46vh;padding:6px 8px}
#cMain{height:100%}
/* Fullscreen */
#chartView.fs .topbar,#chartView.fs .priceLine,#chartView.fs .tfTabs,#chartView.fs .tvToolbar,#chartView.fs .maLegend,#chartView.fs .sentiment,#chartView.fs .orderWrap{display:none}
#chartView.fs .chartWrap{position:fixed;inset:0;z-index:10000;padding:0}
#chartView.fs #cMain{height:100vh !important}
#fsExit{display:none;position:fixed;right:12px;top:12px;z-index:10001}
#chartView.fs #fsExit{display:flex}
.maLegend{padding:4px 12px;font-size:12px;color:#475467}

/* Sentiment + Orders */
.sentiment{display:flex;margin:10px 12px;border-radius:10px;overflow:hidden;border:1px solid var(--line)}
.sCell{flex:1;padding:8px 10px;font-weight:700}.sCell.sell{background:#fee2e2;color:var(--red)} .sCell.buy{background:#dcfce7;color:var(--green)}
.orderWrap{padding:10px 12px}
.orderTabs{display:flex;gap:18px;margin-bottom:8px}
.orderTab{padding:6px 0;border-bottom:2px solid transparent;color:#475467;cursor:pointer}
.orderTab.active{color:#111;border-color:#f59e0b}
.orderBox{display:flex;gap:10px;align-items:center;border:1px solid #fce2e2;background:#fff5f5;border-radius:12px;padding:10px;margin-bottom:10px}
.orderBox .lbl{flex:0 0 48px;color:#ef4444;font-weight:800}
.orderBox.buy{border-color:#e2fbe2;background:#f6fff6}.orderBox.buy .lbl{color:#16a34a}
.priceBox{flex:1;background:#fff;border-radius:10px;border:1px solid var(--line);padding:8px 10px;font-weight:800}
.volume{display:flex;align-items:center;gap:10px;margin:8px 0}
.volBtn{width:36px;height:36px;border:1px solid var(--line);border-radius:10px;background:#fff;font-size:20px}
.total{font-weight:800;margin-top:6px}
.btnRow{display:flex;gap:10px;margin-top:8px}
.aBtn{flex:1;padding:12px;border:none;border-radius:12px;font-weight:800;color:#fff;font-size:16px}
.sellBtn{background:var(--red)} .buyBtn{background:var(--green)}

/* ========== ACCOUNT PAGE (new) ========== */
.profileTop{display:flex;gap:12px;align-items:center;padding:16px}
.avatar{width:56px;height:56px;border-radius:50%;background:#edf2f7;object-fit:cover}
.pInfo{flex:1}
.pName{font-size:20px;font-weight:900;display:flex;align-items:center;gap:6px}
.badge{font-size:12px;background:#e0f2fe;color:#0369a1;padding:2px 6px;border-radius:999px}
.ref{font-size:13px;color:#6b7280;margin-top:2px;display:flex;align-items:center;gap:6px}
.iconBtn{border:1px solid var(--line);background:#fff;border-radius:10px;width:38px;height:38px;display:grid;place-items:center}

.banner{margin:0 16px 12px;padding:12px;border-radius:14px;background:#fff7ed;border:1px solid #fde68a;display:flex;justify-content:space-between;align-items:center}
.banner .tag{font-weight:800}
.smallGrid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:0 16px 14px}
.smallCard{border:1px solid var(--line);background:#fff;border-radius:12px;padding:12px;display:flex;justify-content:space-between;align-items:center}
.smallCard .left{flex-direction:column;align-items:flex-start}
.smallCard .title{font-weight:800}
.smallCard .sub{font-size:12px;color:#6b7280}

.accTabs{display:flex;gap:18px;padding:0 16px;border-bottom:1px solid var(--line)}
.accTab{padding:10px 4px;color:#6b7280;border-bottom:2px solid transparent;cursor:pointer}
.accTab.active{color:#111;border-color:#111;font-weight:800}
.balanceBox{padding:14px 16px;border-bottom:1px solid var(--line);display:flex;align-items:center;gap:10px}
.money{font-size:28px;font-weight:900}
.eye{cursor:pointer}
.kv{display:flex;justify-content:space-between;padding:10px 16px;border-bottom:1px solid var(--line);font-size:14px}
.btnWideRow{display:flex;gap:14px;padding:12px 16px}
.btnWide{flex:1;padding:12px;border:none;border-radius:12px;font-weight:900}
.yellow{background:#facc15} .gray{background:#e5e7eb}

/* List items */
.listBox{margin-top:8px}
.item{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--line)}
.item .l{display:flex;align-items:center;gap:10px}
.item .icon{width:28px;height:28px;border-radius:8px;background:#f3f4f6;display:grid;place-items:center}
.chev{color:#9ca3af}
.center{display:grid;place-items:center;height:100%;color:#475467}
</style>
</head>
<body>

<!-- HOME -->
<section id="homePage" class="page">
  <div class="header">Home</div>
  <div class="center">Welcome to <b>JK ALGO</b>. Go to Market.</div>
</section>

<!-- MARKET -->
<section id="marketPage" class="page show">
  <div class="header">Market</div>
  <div class="tabs">
    <div class="tab active">Hot</div><div class="tab">Favourite</div><div class="tab">Forex</div>
    <div class="tab">Crypto</div><div class="tab">Metals</div><div class="tab">Indices</div>
  </div>
  <div id="list" class="list"></div>
</section>

<!-- DISCOVER -->
<section id="discoverPage" class="page">
  <div class="header">Discover</div>
  <div class="center">Insights — coming soon.</div>
</section>

<!-- ACCOUNT (new) -->
<section id="accountPage" class="page">
  <div class="header">My Account</div>

  <!-- top profile -->
  <div class="profileTop">
    <img id="avatar" class="avatar" src="https://i.pravatar.cc/100?img=12" alt="">
    <div class="pInfo">
      <div class="pName"><span id="accName">Guest</span> <span class="badge">Lv.1</span></div>
      <div class="ref">Referral code: <b id="refCode">—</b>
        <button id="copyRef" class="iconBtn" title="Copy"><span class="mi">content_copy</span></button>
      </div>
    </div>
    <div style="display:flex;gap:8px">
      <button class="iconBtn" title="Theme"><span class="mi">dark_mode</span></button>
      <button class="iconBtn" title="Notifications"><span class="mi">notifications</span></button>
      <button class="iconBtn" title="Help"><span class="mi">headset_mic</span></button>
    </div>
  </div>

  <!-- premium banner -->
  <div class="banner">
    <div><div class="tag">Premium</div><div style="font-size:12px;color:#6b7280">Saved <b>$0.00</b></div></div>
    <button class="btnWide yellow" style="width:96px;border-radius:999px">Buy</button>
  </div>

  <!-- small tiles -->
  <div class="smallGrid">
    <div class="smallCard">
      <div class="left"><div class="title">Activity Coupon</div><div class="sub">0 coupons</div></div>
      <div class="icon"><span class="mi">local_offer</span></div>
    </div>
    <div class="smallCard">
      <div class="left"><div class="title">Rewards Hub</div><div class="sub"><b id="coins">0</b> coins</div></div>
      <div class="icon"><span class="mi">attach_money</span></div>
    </div>
  </div>

  <!-- account tabs & balance -->
  <div class="accTabs">
    <div class="accTab active" data-tab="trade">Trading Account</div>
    <div class="accTab" data-tab="invest">Investment Account</div>
    <div style="margin-left:auto;color:#6b7280;padding:10px 16px"><span class="mi">info</span></div>
  </div>

  <div class="balanceBox">
    <div class="money" id="bal">$0.27</div>
    <span class="mi eye" id="eye">visibility</span>
    <div style="margin-left:auto;color:#6b7280">≈ <span id="inr">₹24.30</span> INR</div>
  </div>
  <div class="kv"><div>Equity</div><b id="equity">$0.27</b></div>
  <div class="kv"><div>Free Margin</div><b id="margin">$0.27</b></div>

  <div class="btnWideRow">
    <button class="btnWide gray" id="withdraw">Withdraw</button>
    <button class="btnWide yellow" id="deposit">Deposit</button>
  </div>

  <!-- list items -->
  <div class="listBox">
    <div class="item"><div class="l"><div class="icon"><span class="mi">military_tech</span></div>My Level</div><div class="chev">Lv.1 <span class="mi">chevron_right</span></div></div>
    <div class="item"><div class="l"><div class="icon"><span class="mi">rocket</span></div>MT4/MT5 Trading</div><button class="btnWide yellow" style="width:92px">Activate</button></div>
    <div class="item"><div class="l"><div class="icon"><span class="mi">handshake</span></div>Partner</div><span class="mi chev">chevron_right</span></div>
    <div class="item"><div class="l"><div class="icon"><span class="mi">stacked_line_chart</span></div>Investment Account</div><span class="mi chev">chevron_right</span></div>
  </div>

  <div style="padding:16px;text-align:center">
    <button id="logoutBtn" class="tbtn"><span class="mi">logout</span>&nbsp;Logout</button>
  </div>
</section>

<!-- bottom nav -->
<nav class="nav" id="bottomNav">
  <a data-route="home"><span class="mi">home</span><span>Home</span></a>
  <a data-route="market" class="active"><span class="mi">candlestick_chart</span><span>Market</span></a>
  <a data-route="trade"><span class="mi">description</span><span>Trade</span></a>
  <a data-route="discover"><span class="mi">explore</span><span>Discover</span></a>
  <a data-route="account" id="acctTab"><span class="mi">person</span><span>My Account</span></a>
  <a data-route="login" id="loginTab" style="display:none"><span class="mi">login</span><span>Login</span></a>
</nav>

<!-- CHART OVERLAY (same as before) -->
<section id="chartView">
  <div class="topbar">
    <span class="mi" id="btnBack">arrow_back</span>
    <div class="pTitle" id="pTitle">PAIR</div>
    <div class="pStats" id="pStats">24h H: -- &nbsp; L: --</div>
  </div>
  <div class="priceLine">
    <div class="livePrice" id="livePrice">--</div>
    <div class="livePct" id="livePct">--</div>
  </div>
  <div class="tfTabs" id="tfTabs"></div>
  <div class="tvToolbar">
    <button class="tbtn"><span class="mi">candlestick_chart</span></button>
    <button class="tbtn"><span class="mi">show_chart</span></button>
    <button class="tbtn"><span class="mi">add</span></button>
    <button class="tbtn"><span class="mi">insights</span> Indicators</button>
    <button class="tbtn" id="btnFull"><span class="mi">fullscreen</span></button>
  </div>
  <button class="tbtn" id="fsExit"><span class="mi">fullscreen_exit</span></button>
  <div class="maLegend">MA5 / MA10 / MA30 (TradingView में Indicators से जोड़ें)</div>
  <div class="chartWrap"><div id="cMain"></div></div>
  <div class="sentiment">
    <div class="sCell sell" id="sellPct">SELL --%</div>
    <div class="sCell buy" id="buyPct">BUY --%</div>
  </div>
  <div class="orderWrap">
    <div class="orderTabs"><div class="orderTab active">Market Order</div><div class="orderTab">Pending Order</div></div>
    <div class="orderBox"><div class="lbl">Sell</div><div class="priceBox" id="obid">--</div><div class="chip">Bid</div></div>
    <div class="orderBox buy"><div class="lbl">Buy</div><div class="priceBox" id="oask">--</div><div class="chip">Ask</div></div>
    <div class="volume"><span>Volume (lot)</span><button class="volBtn" id="minus">−</button><strong id="lot">0.06</strong><button class="volBtn" id="plus">+</button></div>
    <div class="total" id="total">Total: $0.00</div>
    <div class="btnRow"><button class="aBtn sellBtn">SELL</button><button class="aBtn buyBtn">BUY</button></div>
  </div>
</section>

<script>
/* ======= AUTH ======= */
const AUTH_KEY='auth_user';
function user(){ try{ return JSON.parse(localStorage.getItem(AUTH_KEY)||'null'); }catch(_){ return null; } }
function ensureAuthOrRedirect(){ if(!user()){ window.location.href='login.html'; } }
ensureAuthOrRedirect();

/* show Login tab when logged out (not hit because guard redirects), kept for completeness */
(function(){
  const u=user(); const acct=document.getElementById('acctTab'); const logn=document.getElementById('loginTab');
  if(u){ acct.style.display='flex'; logn.style.display='none'; } else { acct.style.display='none'; logn.style.display='flex'; }
})();

/* ========= MARKET ========= */
const COINS=[{sym:'BTCUSDT',name:'BTC/USDT',icon:'btc'},{sym:'ETHUSDT',name:'ETH/USDT',icon:'eth'},{sym:'SOLUSDT',name:'SOL/USDT',icon:'sol'},{sym:'XRPUSDT',name:'XRP/USDT',icon:'xrp'},{sym:'DOGEUSDT',name:'DOGE/USDT',icon:'doge'},{sym:'TRXUSDT',name:'TRX/USDT',icon:'trx'},{sym:'ADAUSDT',name:'ADA/USDT',icon:'ada'},{sym:'ETCUSDT',name:'ETC/USDT',icon:'etc'}];
const iconUrl=(code,size=64)=>`https://cryptoicons.org/api/icon/${code}/${size}`;
const fmt=n=>(n==null?'--':(+n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2}));
async function fetchJson(urls){ for(const u of urls){ try{ const r=await fetch(u,{cache:'no-store'}); if(r.ok) return await r.json(); }catch(e){} } return null; }
const bookUrl=s=>[`https://data.binance.com/api/v3/ticker/bookTicker?symbol=${s}`,`https://api.binance.com/api/v3/ticker/bookTicker?symbol=${s}`];
const dayUrl =s=>[`https://data.binance.com/api/v3/ticker/24hr?symbol=${s}`,`https://api.binance.com/api/v3/ticker/24hr?symbol=${s}`];
const klineUrl=(s,i,n=120)=>[`https://data.binance.com/api/v3/klines?symbol=${s}&interval=${i}&limit=${n}`,`https://api.binance.com/api/v3/klines?symbol=${s}&interval=${i}&limit=${n}`];
const depthUrl=s=>[`https://data.binance.com/api/v3/depth?symbol=${s}&limit=50`,`https://api.binance.com/api/v3/depth?symbol=${s}&limit=50`];

const list=document.getElementById('list');
list.innerHTML=COINS.map((c,i)=>`
  <div class="row" onclick="openPair(${i})">
    <div class="left"><img class="logo" src="${iconUrl(c.icon)}" onerror="this.style.display='none'">
      <div class="names"><div class="pair">${c.name}</div><div class="pct na" id="pct-${i}">--</div></div>
    </div>
    <div class="spark" id="spark-${i}"></div>
    <div class="right"><div class="pill sell" id="sell-${i}">--</div><div class="pill buy" id="buy-${i}">--</div></div>
  </div>`).join('');
function drawSpark(container,closes){
  container.innerHTML='';
  const ch=LightweightCharts.createChart(container,{layout:{background:{type:'Solid',color:'#fff'},textColor:'#555'},
  grid:{vertLines:{color:'#fff'},horzLines:{color:'#fff'}},rightPriceScale:{visible:false},timeScale:{visible:false},
  width:container.clientWidth,height:container.clientHeight});
  const s=ch.addLineSeries({lineWidth:2}); const base=Math.floor(Date.now()/1000)-closes.length*60;
  s.setData(closes.map((v,i)=>({time:base+i*60,value:v})));
}
async function updateRow(c,i){
  const [book,day,kl]=await Promise.all([fetchJson(bookUrl(c.sym)),fetchJson(dayUrl(c.sym)),fetchJson(klineUrl(c.sym,'1m',120))]);
  const bid=book?.bidPrice?+book.bidPrice:null, ask=book?.askPrice?+book.askPrice:null;
  document.getElementById(`sell-${i}`).textContent=fmt(bid);
  document.getElementById(`buy-${i}`).textContent=fmt(ask);
  const pctEl=document.getElementById(`pct-${i}`);
  if(day?.priceChangePercent!=null){ const p=+day.priceChangePercent; pctEl.textContent=(p>=0?'+':'')+p.toFixed(2)+'%'; pctEl.className='pct '+(p>0?'up':p<0?'down':'na'); } else { pctEl.textContent='--'; pctEl.className='pct na'; }
  if(Array.isArray(kl)){ drawSpark(document.getElementById(`spark-${i}`), kl.map(k=>+k[4])); }
}
async function updateMarket(){ await Promise.all(COINS.map(updateRow)); }
updateMarket(); setInterval(updateMarket,5000);

/* ========= CHART ========= */
const cv=document.getElementById('chartView'), btnBack=document.getElementById('btnBack'), btnFull=document.getElementById('btnFull'), fsExit=document.getElementById('fsExit');
btnBack.onclick=()=>{ location.hash='#market'; };
const pTitle=document.getElementById('pTitle'), pStats=document.getElementById('pStats');
const livePriceEl=document.getElementById('livePrice'), livePctEl=document.getElementById('livePct');
const tfTabs=document.getElementById('tfTabs'), cMain=document.getElementById('cMain');
const TFs=['1m','5m','15m','30m','1h','4h']; TFs.forEach((tf,idx)=>{ const d=document.createElement('div'); d.className='tf'+(idx===2?' active':''); d.textContent=tf; d.dataset.tf=tf; tfTabs.appendChild(d); });
let active={sym:'BTCUSDT',name:'BTC/USDT',tf:'15m'}, tvWidget=null;
const tvMap={'1m':'1','5m':'5','15m':'15','30m':'30','1h':'60','4h':'240'};
function toggleFS(forceOff=false){ if(forceOff){cv.classList.remove('fs');btnFull.innerHTML='<span class="mi">fullscreen</span>';return;} cv.classList.toggle('fs'); btnFull.innerHTML=cv.classList.contains('fs')?'<span class="mi">fullscreen_exit</span>':'<span class="mi">fullscreen</span>'; }
btnFull.onclick=()=>toggleFS(); fsExit.onclick=()=>toggleFS(true);
function mountTV(){ cMain.innerHTML='<div id="tvchart" style="width:100%;height:100%"></div>'; tvWidget=new TradingView.widget({autosize:true,symbol:`BINANCE:${active.sym}`,interval:tvMap[active.tf]||'15',timezone:"Etc/UTC",theme:"light",style:"1",container_id:"tvchart",withdateranges:true,allow_symbol_change:false}); }
async function loadChart(){
  pTitle.textContent=active.name; cv.style.display='flex'; mountTV();
  const day=await fetchJson(dayUrl(active.sym));
  if(day){ livePriceEl.textCo

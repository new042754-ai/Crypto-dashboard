<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CryptoTrader</title>
<link rel="preconnect" href="https://s3.tradingview.com">
<style>
  :root{--bg:#0b0f14;--panel:#121821;--text:#e8f0ff;--muted:#8fa3c7;--green:#16c784;--red:#ff4d4f;--btn:#1e2a3a;--btn2:#2a3a51}
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font:600 15px/1.4 Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .top{position:fixed;inset:0 0 auto 0;height:56px;display:flex;gap:8px;align-items:center;padding:8px 12px;background:linear-gradient(180deg,rgba(9,13,19,.9),rgba(9,13,19,.6));border-bottom:1px solid #1b2432;z-index:9}
  .brand{font-weight:800}
  .pill{margin-left:8px;padding:7px 10px;border-radius:10px;background:var(--panel);color:var(--muted);border:1px solid #1b2736}
  .row{display:flex;gap:8px;margin-left:auto}
  button{border:1px solid #263346;background:var(--btn);color:var(--text);padding:9px 14px;border-radius:10px;cursor:pointer;font-weight:700}
  button:hover{background:var(--btn2)}
  .symbol-btn{min-width:70px}
  .active{outline:2px solid #3b82f6}
  .start{background:rgba(22,199,132,.15);border-color:#1e3f35;color:var(--green)}
  .stop{background:rgba(255,77,79,.15);border-color:#4a1f22;color:var(--red)}

  #stage{position:fixed;inset:56px 0 0 0}
  #tv_chart{position:absolute;inset:0}
  .hidden{display:none}

  /* idle screen */
  .empty{height:100%;display:grid;place-items:center;color:var(--muted)}
  .empty .box{background:var(--panel);border:1px solid #1b2736;padding:18px 22px;border-radius:14px}
</style>
</head>
<body>
  <div class="top">
    <div class="brand">ðŸ“ˆ CryptoTrader <span class="pill"><span id="dot" style="width:8px;height:8px;display:inline-block;border-radius:50%;background:#8fa3c7;margin-right:6px"></span><span id="stateTxt">Stopped</span></span></div>
    <div class="row">
      <button id="btcBtn" class="symbol-btn">BTC</button>
      <button id="ethBtn" class="symbol-btn">ETH</button>
      <button id="startBtn" class="start">Start</button>
      <button id="stopBtn" class="stop">Stop</button>
    </div>
  </div>

  <div id="stage">
    <!-- idle view (chart hidden) -->
    <div id="idle" class="empty">
      <div class="box">Chart hidden. Tap <b>BTC</b> or <b>ETH</b> to show.</div>
    </div>
    <!-- chart container (starts hidden) -->
    <div id="tv_chart" class="hidden"></div>
  </div>

  <script src="https://s3.tradingview.com/tv.js"></script>
  <script>
    let tvWidget, currentSymbol = null;

    function loadChart(symbol){
      // toggle buttons active
      document.getElementById('btcBtn').classList.toggle('active', symbol.includes('BTC'));
      document.getElementById('ethBtn').classList.toggle('active', symbol.includes('ETH'));

      // show chart, hide idle
      document.getElementById('idle').classList.add('hidden');
      const chartDiv = document.getElementById('tv_chart');
      chartDiv.classList.remove('hidden');
      chartDiv.innerHTML = "";

      tvWidget = new TradingView.widget({
        container_id: 'tv_chart',
        autosize: true,
        symbol,
        interval: "60",
        theme: "dark",
        style: "1",
        locale: "en",
        hide_top_toolbar: false,
        allow_symbol_change: true,
        studies: ["MASimple@tv-basicstudies","MACD@tv-basicstudies"],
        withdateranges: true
      });
      currentSymbol = symbol;
    }

    // buttons
    document.getElementById('btcBtn').onclick = ()=> loadChart("BINANCE:BTCUSDT");
    document.getElementById('ethBtn').onclick = ()=> loadChart("BINANCE:ETHUSDT");

    // Start/Stop just UI state for now (no backend trading on Pages)
    const dot = document.getElementById('dot'), stateTxt = document.getElementById('stateTxt');
    function setRun(f){ localStorage.setItem('algoRunning', JSON.stringify(f));
      dot.style.background = f ? "#16c784" : "#8fa3c7"; stateTxt.textContent = f ? "Running" : "Stopped";
      document.getElementById('startBtn').disabled = f; document.getElementById('stopBtn').disabled = !f;
    }
    document.getElementById('startBtn').onclick = ()=> setRun(true);
    document.getElementById('stopBtn').onclick  = ()=> setRun(false);
    setRun(JSON.parse(localStorage.getItem('algoRunning')||"false"));
  </script>
</body>
</html>

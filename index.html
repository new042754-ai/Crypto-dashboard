<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CryptoTrader</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: white;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    header {
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 10px;
      background-color: #222;
    }
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    .btn-btc, .btn-eth {
      background-color: #333;
      color: white;
    }
    .btn-start {
      background-color: green;
      color: white;
    }
    .btn-stop {
      background-color: brown;
      color: white;
    }
    .status {
      margin: 10px 0;
      font-weight: bold;
    }
    .status.stopped {
      color: red;
    }
    .status.running {
      color: green;
    }
    .price-card {
      background: #222;
      padding: 15px;
      border-radius: 8px;
      margin: 10px auto;
      width: 250px;
      cursor: pointer;
    }
    .price {
      font-size: 1.5em;
      margin-top: 5px;
    }
    /* Overlay for chart */
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      z-index: 9999;
      flex-direction: column;
    }
    .overlay.show {
      display: flex;
    }
    .overlay-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #000;
      padding: 10px;
      color: white;
    }
    #tv-container {
      flex: 1;
    }
  </style>
</head>
<body>

<header>
  <button class="btn-btc" id="btn-btc">BTC</button>
  <button class="btn-eth" id="btn-eth">ETH</button>
  <button class="btn-start" id="start">Start</button>
  <button class="btn-stop" id="stop">Stop</button>
</header>

<div id="algo-status" class="status stopped">Algo Stopped</div>

<div class="price-card" id="card-btc">
  <div>BTC</div>
  <div class="price" id="price-btc">--</div>
</div>

<div class="price-card" id="card-eth">
  <div>ETH</div>
  <div class="price" id="price-eth">--</div>
</div>

<!-- Chart overlay -->
<div class="overlay" id="overlay">
  <div class="overlay-header">
    <span id="overlay-title"></span>
    <button id="ov-close">Close</button>
  </div>
  <div id="tv-container"></div>
</div>

<script src="https://s3.tradingview.com/tv.js"></script>
<script>
  const statusEl = document.getElementById('algo-status');
  document.getElementById('start').onclick = () => {
    statusEl.textContent = 'Algo Running';
    statusEl.className = 'status running';
  };
  document.getElementById('stop').onclick = () => {
    statusEl.textContent = 'Algo Stopped';
    statusEl.className = 'status stopped';
  };

  // Price update function
  async function fetchPrice(symbol, el) {
    try {
      const res = await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${symbol}`);
      const data = await res.json();
      el.textContent = `$${parseFloat(data.price).toLocaleString()}`;
    } catch (e) {
      el.textContent = '--';
    }
  }

  function updatePrices() {
    fetchPrice('BTCUSDT', document.getElementById('price-btc'));
    fetchPrice('ETHUSDT', document.getElementById('price-eth'));
  }
  updatePrices();
  setInterval(updatePrices, 5000);

  // TradingView Chart
  const overlay = document.getElementById('overlay');
  const overlayTitle = document.getElementById('overlay-title');
  const tvContainer = document.getElementById('tv-container');

  function openChart(label, symbol) {
    overlay.classList.add('show');
    overlayTitle.textContent = label + ' â€” TradingView';
    tvContainer.innerHTML = '';
    new TradingView.widget({
      autosize: true,
      symbol: symbol,
      interval: "60",
      timezone: "Etc/UTC",
      theme: "dark",
      style: "1",
      container_id: "tv-container",
      locale: "en",
      withdateranges: true,
      allow_symbol_change: false
      // No indicators (clean chart)
    });
  }

  document.getElementById('card-btc').onclick = () => openChart('BTC/USDT', 'BINANCE:BTCUSDT');
  document.getElementById('card-eth').onclick = () => openChart('ETH/USDT', 'BINANCE:ETHUSDT');
  document.getElementById('ov-close').onclick = () => overlay.classList.remove('show');
</script>

</body>
</html>
